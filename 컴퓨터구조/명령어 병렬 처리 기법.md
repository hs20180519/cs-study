
## 00. 명령어 병렬 처리 기법


### 개념
CPU 내부에서 효율적인 자원 활용을 위해, **명령어**를 여러 단계로 나누거나 동시에 실행하는 기술
**명령어** 단위의 병렬 처리이기 때문에, 싱글 스레드 환경에서도 가능하다.


### 종류

1. **명령어 파이프라이닝**
    - 명령어를 여러 단계로 나누어 병렬로 처리하는 기법
2. **슈퍼스칼라**
    - 여러 개의 파이프라인을 사용해 한 번에 여러 명령어를 처리하는 방식
3. **비순차적 명령어 처리**
    - 명령어 간의 데이터 의존성이 없을 경우 순서를 바꾸어 병렬로 처리하는 방법

<img src="https://velog.velcdn.com/images/jaewan/post/826b06b2-53ff-45c1-b601-4306b68f5cc0/image.png">


#### 명령어 단계

CPU는 명령어를 네 가지 단계로 나누어 처리한다.

| 용어 | 개념 |
| --- | --- |
| 명령어 인출 | 메모리에서 명령어를 가져오는 단계.                 |
| 명령어 해석 | 가져온 명령어를 해석하고, 실행에 필요한 정보를 준비하는 단계. |
| 명령어 실행 | 연산을 수행하거나 메모리에 접근하는 단계              |
| 명령어 저장 | 연산 결과를 레지스터 또는 메모리에 저장하는 단계         |




### 01. 명령어 파이프라이닝

#### 1. 명령어 파이프라이닝 개념

- 명령어 처리 과정을 여러 단계로 나누어 병렬로 처리하는 기법 
- 각 명령어가 다른 단계에서 처리되므로, 여러 명령어가 동시에 진행될 수 있다.
- 예를 들어, 한 명령어가 "명령어 인출" 단계에 있을 때, 다음 명령어는 "명령어 해석" 단계에 있을 수 있다. 

#### 2. 파이프라인 위험

파이프라인을 사용하며, 성능 향상에 실패하는 경우를 **파이프라인 위험** 이라 한다.

1. **데이터 위험**
    - 명령어 간에 데이터 의존성이 있을 경우 발생 
    - 예를 들어, 이전 명령어의 결과를 다음 명령어가 필요로 할 때, 결과가 준비되지 않으면 문제가 생긴다.
```
명령어 1 : R1 <- R2 + R3
명령어 2 : R4 <- R1 + R5 // 명령어 1을 수행해야만 2를 수행할 수 있다
```

2. **제어 위험**
	- 분기문이나 조건문 등 **프로그램 카운터의 갑작스러운 변화**에 의해 발생
    - 예측이 실패할 경우 파이프라인이 중단되고 다시 시작해야 한다.
    - **분기 예측** : 프로그램이 어디로 분기할지 미리 예측하고 그 구조를 인출하는 기술
    
3.  **구조적 위험, 자원 위험**
    - ALU, 레지스터 등 **하드웨어 자원이 부족할 경우 발생**
    
## 02. 슈퍼스칼라

### 1. 개념

- 슈퍼스칼라 프로세서는 여러 파이프라인을 병렬로 사용하여 한 클럭 사이클에 여러 명령어를 동시에 실행할 수 있는 CPU를 말한다. 
- 파이프라이닝보다 높은 처리 속도를 제공하며, 현대의 대부분의 프로세서에서 사용되고 있다.

### 2. 특징

- **프로그램 처리 속도**
    - 한 번에 여러 명령어를 처리할 수 있어 프로그램 처리 속도가 증가한다.
- **제한 사항**
    - 파이프라인 위험(데이터 위험, 제어 위험, 구조적 위험)으로 인해 파이프라인 개수가 늘어난다고 해서 성능이 비례적으로 향상되지는 않는다.

## 03. 비순차적 명령어 처리

### 1. 개념

- 기본적으로 명령어 처리는 작성된 순서대로 순차적으로 실행된다. 
- 순차 처리 방식은 파이프라인 위험과 같은 이유로, 명령어 파이프라인을 멈춰야 하는 상황이 발생할 수 있다.
- 따라서 **데이터 의존성이 없는 명령어**의 경우, 순차적 실행 대신 먼저 실행할 수 있는데, 이를 **비순차적 명령어 처리**라고 한다.

### 2. 장점

- 파이프라인 중단을 방지할 수 있다.
- 데이터 의존성이 없는 명령어를 먼저 실행하여 처리 속도를 높일 수 있다.
- 명령어 대기 시간을 줄이고, CPU 자원을 효율적으로 사용할 수 있다.

## 04. 예상 질문

### 1. 명령어 파이프라이닝이란 무엇이며, 어떤 이점이 있습니까?


명령어 파이프라이닝은 명령어를 여러 단계로 나누어 각 단계가 병렬로 처리되도록 하는 기술입니다.
예를 들어, 한 명령어가 "명령어 인출" 단계에 있을 때, 다른 명령어는 "명령어 실행" 단계에 있을 수 있습니다. 
이를 통해 CPU 자원을 효율적으로 활용하고, 처리 속도를 향상시킬 수 있습니다. 


### 2. 파이프라이닝에서 발생하는 주요 위험 요소는 무엇이며, 이를 어떻게 해결할 수 있습니까?

파이프라이닝에서 발생하는 주요 위험 요소는 데이터 위험, 제어 위험, 구조적 위험이 있습니다.

- **데이터 위험:** 명령어 간 데이터 의존성이 있을 때 발생합니다.
- **제어 위험:** 제어문, 분기문 등으로 프로그램 카운터가 갑작스럽게 변화할 때 발생합니다. 이런 제어 위험을 해결하기 위해 _분기 예측_ 기술을 사용합니다.
- **구조적 위험:** ALU, 레지스터와 같은 하드웨어 자원이 부족할 때 발생합니다

### 3. **질문:** 비순차적 명령어 처리(Out-of-Order Execution)란 무엇이며, 어떤 경우에 유용합니까?

**답변:**  
비순차적 명령어 처리는 명령어 간 데이터 의존성이 없는 경우 순서를 바꾸어 병렬로 실행하는 기술입니다.  
파이프라인이 중단을 방지할 수 있기 때문에 CPU 자원을 최대한 활용하고, 명령어 대기 시간을 줄이는 데 유용합니다. 



