# 00. 데이터베이스 이상 현상 (Anomaly)

잘못 설계된 데이터베이스에서는 데이터 중복으로 인해 삽입, 수정, 삭제 작업에서 여러 부작용이 발생할 수 있다. 
이러한 부작용을 **이상(anomaly)**이라고 하며, 이를 해결하기 위해 **정규화**가 필요하다. 
이상 현상에은 삽입 이상, 갱신 이상, 삭제 이상이 있다.

## 01. 삽입 이상 (Insertion Anomaly)

새 데이터를 삽입할 때, 불필요한 데이터도 함께 삽입해야 하는 문제.

### 예시
| 학번(PK)  | 수강과목번호(PK) | 성적 | 이름   | 나이 | 주소   |
|-----------|------------------|------|--------|------|--------|
| 20101111  | 0002             | A    | 홍길동 | 21   | 서울시 |
| 20091514  | 0001             | B+   | 김영희 | 25   | 대전시 |
| 20181966  | 0003             | C    | 이지수 | 23   | 부산시 |
| 20101254  | 0004             | B+   | 김민수 | 27   | 광주시 |
| 20190001  | null             | null | 이진영 | 20   | 제주시 |

- 이진영 학생은 아직 수강한 과목이 없어서 `수강과목번호`와 `성적`을 채울 수 없으나, 기본 키(PK)가 설정되어 있어 `null` 값을 넣어야만 삽입이 가능하다. 
이러한 문제를 **삽입 이상**이라 한다.

## 02. 갱신 이상 (Update Anomaly)

중복된 튜플 중 일부만 수정되어 데이터 불일치가 발생하는 문제.

### 예시
| 학번(PK)  | 수강과목번호(PK) | 성적 | 이름   | 나이 | 주소   |
|-----------|------------------|------|--------|------|--------|
| 20101111  | 0002             | A    | 홍길동 | 21   | 안양시 |
| 20101111  | 0003             | A+   | 홍길동 | 21   | 서울시 |

- 홍길동의 주소를 `안양시`로 변경했지만, 또 다른 튜플에서는 여전히 `서울시`로 남아 있다. 이로 인해 데이터 불일치가 발생하며, 이를 **갱신 이상**이라 한다.

## 03. 삭제 이상 (Delete Anomaly)

튜플을 삭제할 때, 필요한 데이터까지 함께 삭제되어 데이터 손실이 발생하는 문제.

### 예시
| 학번(PK)  | 수강과목번호(PK) | 성적 | 이름   | 나이 | 주소   |
|-----------|------------------|------|--------|------|--------|
| 20101111  | 0002             | A    | 홍길동 | 21   | 서울시 |
| 20091514  | 0001             | B+   | 김영희 | 25   | 대전시 |
| 20181966  | 0003             | C    | 이지수 | 23   | 부산시 |

- 홍길동 학생이 수강 과목 `0002`를 취소하면서 관련 튜플을 삭제했는데, 이에 따라 `홍길동`의 나이와 주소 정보도 함께 삭제되었다. 
이처럼 원하지 않는 데이터까지 삭제되는 현상을 **삭제 이상**이라 한다.



## 04. 연습문제
### 문제 1.
다음 테이블 Student에서 새로운 학생의 이름과 나이를 삽입하려고 한다. 하지만 학생이 아직 수강한 과목이 없다면 어떤 문제가 발생할 수 있는가?
``` sql
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    course_id INT,
    grade CHAR(1),
    name VARCHAR(50),
    age INT
);
```
1) 수강 과목이 없기 때문에 데이터를 삽입할 수 없다.
2) 학생의 나이만 삽입할 수 있다.
3) 수강 과목 번호에 임의의 값을 넣어야만 삽입이 가능하다.
4) 기본 키가 없으므로 삽입할 수 없다.


<details><summary>정답</summary>
3. 삽입 이상이 발생한다. 수강 과목 번호에 임의의 값을 넣어야만 삽입이 가능하다.
</details>


### 문제 2.
다음과 같은 데이터를 가진 Student 테이블이 있다. 이 테이블에서 학생 홍길동의 주소를 "서울시"에서 "부산시"로 변경하고자 한다. 갱신 이상이 발생할 수 있는 이유는 무엇인가?

| student_id | course_id | grade | name   | age | address |
|------------|-----------|-------|--------|-----|---------|
| 1          | 101       | A     | 홍길동 | 21  | 서울시  |
| 1          | 102       | B     | 홍길동 | 21  | 서울시  |

1. 중복된 데이터가 있어 일부만 갱신하면 데이터 불일치가 발생할 수 있다.
2. 주소를 갱신할 수 없기 때문에 문제가 없다.
3. student_id가 기본 키이므로, 데이터가 자동으로 갱신된다.
4. course_id가 외래 키로 설정되어 있어 주소를 갱신할 수 없다.

<details><summary>정답</summary>
1. 갱신 이상이 발생한다. 중복된 데이터가 있어 일부만 갱신하면 데이터 불일치가 발생할 수 있다.
</details>



### 문제 3.
다음 Student 테이블에서 수강 과목 101을 삭제하려고 할 때, 어떤 문제가 발생할 수 있는가?

sql
코드 복사
| student_id | course_id | grade | name   | age | address |
|------------|-----------|-------|--------|-----|---------|
| 1          | 101       | A     | 홍길동 | 21  | 서울시  |
| 1          | 102       | B     | 홍길동 | 21  | 서울시  |

1. 홍길동 학생의 모든 정보가 삭제될 수 있다.
2. 나머지 수강 과목이 자동으로 삭제된다.
3. 성적 정보만 삭제되며 학생 정보는 유지된다.
4. 삭제가 불가능하다.


<details><summary>정답</summary>
1. 삭제 이상이 발생한다. 홍길동 학생의 모든 정보가 삭제될 수 있다.
</details>
