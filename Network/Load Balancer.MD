# 01. 로드 밸런싱 개요

![title](https://miro.medium.com/v2/resize:fit:1400/0*Uz7COYXZqR0keVZT.png)   

## 개념
로드 밸런싱은 분산 웹 서비스에서 여러 서버로 들어오는 네트워크 트래픽을 균등하게 분산하는 기술이다. `Load Balancer`는 클라이언트와 서버 사이에 위치해 부하가 발생하지 않도록 요청을 여러 서버에 분산시켜준다. 

사이트의 규모에 따라 웹 서버를 추가로 증설하면서 로드 밸런서로 관리하면 웹 서버의 부하를 효과적으로 해결할 수 있다.

## 장점
- **성능 향상**: 여러 서버에 트래픽을 분산해 응답 시간을 줄이고, 더 많은 사용자의 요청을 처리할 수 있다.
- **가용성**: 특정 서버가 다운되거나 장애가 발생할 때, 로드 밸런서는 자동으로 해당 서버를 제외하고 다른 서버로 트래픽을 분배해 서비스 중단을 방지한다.
- **확장성**: 서버 자원이 부족할 경우 새로운 서버를 추가해 쉽게 확장할 수 있으며, 로드 밸런서는 자동으로 새로운 서버에도 트래픽을 분배한다.


### 스케일 아웃 (Scale-Out) VS 스케일 업 (Scale-Up)

| 항목                | 스케일 아웃 (Scale-Out)                            | 스케일 업 (Scale-Up)                            |
|--------------------|---------------------------------------------------|------------------------------------------------|
| 개념               | 여러 대의 서버를 추가해 수평적으로 확장하는 방식     | 하나의 서버 성능을 높여 수직적으로 확장하는 방식 |
| 처리 성능          | 트래픽이 증가할수록 성능이 선형적으로 향상됨            | 성능 향상은 있지만, 일정 한계점에 도달하면 추가 확장이 어려움 |
| 비용               | 서버 추가 비용 발생, 초기 비용이 낮음                 | 고성능 하드웨어 비용이 높음                      |
| 장애 대응          | 서버 중 하나에 장애가 발생해도 다른 서버가 처리 가능    | 단일 장애점(Single Point of Failure) 문제 발생 가능 |
| 확장성             | 무한히 확장 가능 (이론적으로)                        | 하드웨어 한계로 확장이 제한됨                     |
| 관리 복잡도        | 서버 수가 많아질수록 관리가 복잡해짐                  | 단일 서버로 관리가 간단함                        |

# 02. 로드 밸런싱 알고리즘

### 라운드 로빈 (Round Robin)
클라이언트로부터 받은 요청을 서버에 **순차적으로 할당**하는 방식이다. 모든 서버가 동일한 성능을 갖는 환경에서 적합하며, 트래픽 분산이 고르게 이루어진다.

### 가중 라운드 로빈 (Weighted Round Robin)
각 서버에 가중치를 부여해 **가중치가 높은 서버가 더 많은 요청을 처리**하도록 하는 방식이다. 서버 간 성능 차이가 있을 때 사용된다.

### IP 해싱 (IP Hashing)
클라이언트의 IP 주소를 해싱해 특정 서버에 요청을 할당하는 방식이다. 동일한 IP의 클라이언트는 항상 같은 서버에 연결된다.
세션 유지에 유리하지만 트래픽 불균형이 발생할 수 있다

### 최소 연결 (Least Connection)
현재 연결된 수가 가장 적은 서버에 요청을 할당하는 방식이다. 세션 시간이 길거나 트래픽 부하가 고르지 않은 경우 사용한다.
서버 간 부하를 고르게 분배할 수 있다.

### 최소 응답 시간 (Least Response Time)
**응답 시간이 가장 짧고, 연결 수가 적은 서버**에 트래픽을 할당하는 방식이다. 성능이 좋은 서버를 우선적으로 활용할 수 있다.

# 03. 로드 밸런서 종류

## L4 로드 밸런서
L4 로드 밸런서는 OSI 7계층 중 **전송 계층**(Layer 4)에서 동작하며, 

IP 주소와 포트 번호를 기준으로 트래픽을 분배한다. 빠른 속도와 간단한 설정이 가능하지만, 애플리케이션 레벨에서 세부 조정은 어렵다.

## L7 로드 밸런서
L7 로드 밸런서는 OSI 7계층 중 **응용 계층**(Layer 7)에서 동작하며, 

HTTP 헤더, URL, 쿠키 등의 애플리케이션 데이터를 기반으로 트래픽을 분배한다. 보다 정교한 트래픽 제어가 가능하지만, 처리 속도가 L4에 비해 느릴 수 있다.


| 항목            | L4 로드 밸런서 (전송 계층)                      | L7 로드 밸런서 (응용 계층)                     |
|----------------|------------------------------------------------|------------------------------------------------|
| **작동 계층**    | OSI 7계층 중 4계층(전송 계층, TCP/UDP 기반)       | OSI 7계층 중 7계층(응용 계층, HTTP/HTTPS 기반)  |
| **분배 기준**    | IP 주소와 포트 번호를 기준으로 트래픽 분배           | HTTP 헤더, URL, 쿠키 등 애플리케이션 데이터를 기준으로 트래픽 분배 |
| **속도**        | 패킷을 빠르게 처리할 수 있어 속도가 빠름            | 응용 계층에서 데이터 분석을 하므로 처리 속도가 느림 |
| **유연성**       | 트래픽 분배가 상대적으로 단순함                  | 보다 정교한 트래픽 제어가 가능함                |
| **사용 예**      | 단순한 TCP/UDP 트래픽 처리 (파일 서버, DNS 등)   | 웹 애플리케이션, API 서버 등 복잡한 트래픽 제어가 필요한 경우 |
| **SSL 처리**     | SSL 처리하지 않음                               | SSL 처리 가능                                   |
| **부하 분산**    | 네트워크 레벨에서 트래픽을 분산                  | 애플리케이션 레벨에서 트래픽을 분산             |

---

## 로드 밸런서 이중화
로드 밸런서 이중화는 **고가용성(HA, High Availability)** 을 보장하기 위해 **두 개 이상의 로드 밸런서를 설정**해 한 대에 장애가 발생하더라도 서비스 중단 없이 트래픽을 처리할 수 있도록 구성하는 방법이다.

### 이중화 방법

1. **액티브-액티브 (Active-Active)**:
   - 두 대 이상의 로드 밸런서가 동시에 작동하며, 모든 로드 밸런서가 트래픽을 분산 처리한다.
   - 한 대가 장애를 일으켜도 나머지 로드 밸런서들이 트래픽을 처리하므로 고가용성을 보장한다.
   - 자원을 최대한 활용할 수 있지만, 설정 및 관리가 복잡할 수 있다.

2. **액티브-패시브 (Active-Passive)**:
   - 한 대의 로드 밸런서만 트래픽을 처리하고, 나머지는 대기 상태에 있다가, 액티브 로드 밸런서에 장애가 발생할 경우 패시브 로드 밸런서가 자동으로 트래픽을 인수한다.
   - 자원 활용 효율은 낮지만, 설정이 상대적으로 간단하다.

### 필요성
로드 밸런서 이중화는 서비스 중단에 따른 금전적 손실이나 사용자 불편을 최소화하기 위해 매우 중요한 구성이다. 단일 로드 밸런서에 장애가 발생하면 서비스 전체가 중단될 위험이 있으므로, 이중화를 통해 트래픽 처리를 지속할 수 있어야 한다.
